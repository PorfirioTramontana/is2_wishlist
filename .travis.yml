language: node_js
node_js:
  - "12"

notifications:
  slack: personalslack-m6b6316:8L0xfsI7Z9Gi65IUXRpIj6Tk

cache:
  directories:
    - client/node_modules
    - test-hooks-latest/test-guard/node_modules

addons:
  chrome: stable

# addons:
#   artifacts:
#     # if would like to download artifacts ,travis-ci recommend to upload the remote location like aws s3
#     # set enviroment variable in travis-ci
#     # ARTIFACTS_KEY=(AWS access key id)
#     # ARTIFACTS_SECRET=(AWS secret access key)
#     # ARTIFACTS_BUCKET=(S3 bucket name)
#     # For more information configuration for this ,please refer https://docs.travis-ci.com/user/uploading-artifacts/
#     # this example is store to local hard disk travis-ci
#     target_paths: report/*
#     debug: true

jobs:  
  include:
        
    - stage: "Build"
      
      before_script:
        - cd /home/travis/build/antoniopicone/is2_wishlist/client
        - npm i
        
      script: 
        - npm run build

    - stage: "Verify Hooks"
      
      before_script:
        - cd /home/travis/build/antoniopicone/is2_wishlist/test-hooks-latest/test-guard
        - npm i
        
      script: 
        - cd /home/travis/build/antoniopicone/is2_wishlist/test-hooks-latest/test-guard
        - node main.js verify-hooks '/home/travis/build/antoniopicone/is2_wishlist/client/src/**/*.html' --grammar angularjs --suites '/home/travis/build/antoniopicone/is2_wishlist/tests/1.2/test-cases'

    - stage: "Run Regression Tests"
      before_script:
        - cd /home/travis/build/antoniopicone/is2_wishlist/client
        - json-server ./mocks/database.json &
        
      script: 
        - ng e2e


# # dist: trusty
# # addons:
# #   chrome: stable
# before_script:
#   - "export DISPLAY=:99.0"
#   - "sh -e /etc/init.d/xvfb start"
#   - sleep 3 # give xvfb some time to start
#   - rackup  # start a Web server
#   - sleep 3 # give Web server some time to bind to sockets, etc
# before_install:
#   - # start your web application and listen on `localhost`
#   - google-chrome-stable --headless --disable-gpu --remote-debugging-port=9222 http://localhost &